<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>AutoComplete Sample</title>
<script language="javascript" type="text/javascript" src="../../lib/prototype.js" ></script>
<script language="javascript" type="text/javascript" src="../../src/prototype_ext.js" ></script>
<script language="javascript" type="text/javascript" src="../../src/logger.js" ></script>
<script language="javascript" type="text/javascript" src="../../src/ac.js" ></script>

</head>
<body>
<script language="javascript"    type="text/javascript" ><!--
var people = [
    {id:1, name:"Marchan Fowler", category:1, tel:"03-1234-5678", address:"東京都ど田舎"},
    {id:2, name:"thinkworks", category:2, tel:"03-9876-5432", address:"東京都ど真ん中"},
    {id:3, name:"TAYOTO", category:2, tel:"06-2222-2222", address:"名古屋とかあの辺"},
    {id:4, name:"木田", category:2, tel:"03-8888-8888", address:"和光とか"}
];

--></script>

	<form name="f">
		<table><tr><td>
		<label for="f_id">ID</label><input type="text" id="f_id" name="f_id" /><br/>
		</td></tr>
		<tr><td>
			<label for="f_name">名前</label><input type="text" id="f_name" name="f_name" autocomplete="off"/><br/>
		</td></tr>
		<tr><td>
			<select id="f_category" name="f_category" style="z-index:0">
				<option value="1">法人</option>
				<option value="2">個人</option>
			</select>
		</td></tr>
		<tr><td>
			<label for="f_tel">電話</label><input type="text" id="f_tel" name="f_tel" autocomplete="off"/><br/>
		</td></tr>
		<tr><td>
			<label for="f_address">住所</label><input type="text" id="f_address" name="f_address" autocomplete="off"/><br/>
		</td></tr>
		</table>
	</form>
</body>

<script language="javascript"    type="text/javascript" ><!--

var mappings = [
   { suggestive:false, visible:false, type:"Number", property: "id", field: $("f_id") },
   { suggestive:true , visible:true , type:"String", property: "name", field: $("f_name") },
   { suggestive:false, visible:true , type:"Number", property: "category", field: $("f_category") },
   { suggestive:true , visible:true , type:"String", property: "tel", field: $("f_tel") },
   { suggestive:true , visible:true , type:"String", property: "address", field: $("f_address") }

];

ACFields = Class.create();
ACFields.Mapping = {};
ACFields.Mapping.Methods = {
    getField: function() {
        if (!this.field)
            return null;
        if (this.field.ownerDocument) {
            return this.field;
        } else if (this.field.constructor == String) {
            var field_id _ this.field;
            var field = $(field_id);
            if (!field)
                throw "field[id:" + field_id + "] not found";
            this.field = field;
            return this.field;
        } else if (this.field["className"]) {
            var baseElement = $(args[0]);
            var fieldClassName = this.field["className"];
            if (!baseElement)
                throw "no baseElement specified for className[" + fieldClassName + "]";
            var field = document.getFirstElementByClassName(fieldClassName);
            if (!field)
                throw "field[className:" + fieldClassName + "] not found";
            this.field = field;
            return this.field;
        } else {
            return null;
        }
    },
    observeField: function(acFields, options) {
        this.acFields = acFields;
        this.options = Object.extend(this.options || {}, options);
        this.focusHandler = this.fieldOnFocus.bindAsEventListener(this);
        Event.observe(this.getField(), "focus", this.focusHandler, false);
    },
    fieldOnFocus: function(event) {
        this.activateListener();
    },
    activateListeners: function() {
        this.fieldKeyupHandler = this.fieldKeyup.bindAsEventListener(this);
        Event.observe(this.field, "keyup", this.fieldKeyupHandler, false);
    },
    deactivateListeners: function() {
        if (!this.fieldKeyupHandler)
            return;
        Event.stopObserving(this.field, "keyup", this.fieldKeyupHandler, false);
    },
    fieldKeyup: function(event) {
        this.acFields.searching = false;
        setTimeout(this.acFields.search.bind(this.acFields), this.options["keyup_delay"]);
    }
    
};
ACFields.DefaultOptions = {
    "keyup_delay": 500
};
ACFields.prototype = {
    initialize: function(mappings, options) {
		this.searching = false;
		this.options = Object.extend( $H(ACFields.DefaultOptions), options || {} );
        this.mappings = mappings;
        this.initializeMapping();
        this.observeFieldFocus();
    },
    initializeMapping: function() {
        for(var i = 0; i < this.mappings.length; i++) {
            var mapping = this.mappings[i];
            for(var method in ACFields.Mapping.Methods) {
                if (!mapping[method])
                    mapping[method] = ACFields.Mapping.Methods[method];
            }
        }
    },
    observeFieldFocus: function() {
        for(var i = 0; i < this.mappings.length; i++) {
            this.mappings[i].observeField(this, this.options);
        }
    },
    search: function() {
        this.searching = true;
        var parameters = this.getParameters();
        if (!this.searching)
            return;
        
    },
    getParameters: function() {
        var result = {};
        for(var i = 0; i < this.mappings.length; i++) {
            if (!this.searching)
                return;
            var mapping = this.mappings[i];
            var value = mapping.getvalue();
            result[mapping.property] = value;
        }
        return result;
    },
    getParameters: function() {
    }

}


--></script>


</html>
