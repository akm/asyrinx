<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>brownie-calendar</title>
<script language="javascript" type="text/javascript" src="../../lib/prototype.js" ></script>
<script language="javascript" type="text/javascript" src="../../src/logger.js" ></script>
<script language="javascript" type="text/javascript" src="../../src/prototype_ext.js" ></script>
<script language="javascript" type="text/javascript" src="../../src/date.js" ></script>
<script language="javascript" type="text/javascript" src="../../src/calendar.js" ></script>
</head>
<body>


	Simple Calendar Field: <input type="text" id="simpleCalendarField1"/><br/>
	<table>
	   <tr><td>[Ctrl+LEFT]</td><td>prev date</td></tr>
	   <tr><td>[Ctrl+RIGHT]</td><td>next date</td></tr>
	   <tr><td>[Ctrl+UP]</td><td>prev week</td></tr>
	   <tr><td>[Ctrl+DOWN]</td><td>next week</td></tr>
	   <tr><td>[PAGE_UP]</td><td>prev month</td></tr>
	   <tr><td>[PAGE_DOWN]</td><td>next month</td></tr>
	   <tr><td>[Ctrl+PAGE_UP]</td><td>prev year</td></tr>
	   <tr><td>[Ctrl+PAGE_DOWN]</td><td>next year</td></tr>
	</table>

<script language="javascript" type="text/javascript" ><!--

Logger.setActiveOnLoad(true);

Date.Calendar.KeyController = Class.create();
Date.Calendar.KeyController.prototype = {
    initialize: function(field, model) {
        this.field = $(field);
        this.model = model;
        this.model.attachEvent(this.modelChanged.bind(this));
        this.activate();
    },
    
    prevDate : function(event){ this.model.prevDate(); }, 
    nextDate : function(event){ this.model.nextDate(); }, 
    prevWeek : function(event){ this.model.prevWeek(); }, 
    nextWeek : function(event){ this.model.nextWeek(); }, 
    prevMonth: function(event){ this.model.prevMonth(); }, 
    nextMonth: function(event){ this.model.nextMonth(); }, 
    prevYear : function(event){ this.model.prevYear(); }, 
    nextYear : function(event){ this.model.nextYear(); },
    
    activate: function() {
        var actions = [
            {ctrl: true , key: Event.KEY_LEFT , method: this.prevDate.bindAsEventListener(this) },
            {ctrl: true , key: Event.KEY_RIGHT, method: this.nextDate.bindAsEventListener(this) },
            {ctrl: true , key: Event.KEY_UP   , method: this.prevWeek.bindAsEventListener(this) },
            {ctrl: true , key: Event.KEY_DOWN , method: this.nextWeek.bindAsEventListener(this) },
            {ctrl: false, key: Event.KEY_PAGE_UP  , method: this.prevMonth.bindAsEventListener(this) },
            {ctrl: false, key: Event.KEY_PAGE_DOWN, method: this.nextMonth.bindAsEventListener(this) },
            {ctrl: true , key: Event.KEY_PAGE_UP  , method: this.prevYear.bindAsEventListener(this) },
            {ctrl: true , key: Event.KEY_PAGE_DOWN, method: this.nextYear.bindAsEventListener(this) },
            {matchAll: true, method: this.keyup.bindAsEventListener(this), stopEvent: false }
        ];
        actions.each(function(action){ 
            action.event = "keydown";
            action.shift = false;
            action.alt = false;
        });
        new Event.KeyHandler(this.field, actions);
    },
    
    keyup: function(){
        if (this.lastUpdateModelId){
            clearTimeout(this.lastUpdateModelId);
            this.lastUpdateModelId = null;
        }
        this.lastUpdateModelId = setTimeout(this.updateModel.bind(this), 500);
    },
    
    updateModel: function() {
        this.lastUpdateModelId = null;
        var str = this.field.value;
        if (this.model.isValid(str))
            this.model.setAsString(str);
    },
    
    modelChanged: function() {
        var s = this.model.getAsString();
        if (this.field.value != s)
            this.field.value = s;
    }
}
var model = new Date.Calendar.Model();
new Date.Calendar.KeyController($("simpleCalendarField1"), model);

//new Object.Aspect.Logger(model);

--></script>



</body>
</html>
